var south=L.latLng(-4288,-4288),north=L.latLng(4288,4288),bounds=L.latLngBounds(south,north),map=L.map("map",{center:[51.505,-.09],zoom:2,minZoom:2,maxBounds:bounds}),geocoder=L.Control.Geocoder.nominatim();if("undefined"!=typeof URLSearchParams&&location.search){var params=new URLSearchParams(location.search),geocoderString=params.get("geocoder");geocoderString&&L.Control.Geocoder[geocoderString]?(console.log("Using geocoder",geocoderString),geocoder=L.Control.Geocoder[geocoderString]()):geocoderString&&console.warn("Unsupported geocoder",geocoderString)}var marker,control=L.Control.geocoder({query:"",placeholder:"Recherchez ici ...",geocoder:geocoder}).addTo(map);setTimeout(function(){control.setQuery("")},12e3),L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoibmF0aGFuLS0iLCJhIjoiY2t3NnY0a2dxMHRwNjJ4cWxyOXB2eDVtaSJ9.0Dji_rE_4lPmnIgOAOwm9Q"}).addTo(map);var Temp=L.tileLayer("https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=94c6cf0868fa5cb930a5e2d71baf0dbf",{maxZoom:18,id:"temp"}),Precipitation=L.tileLayer("https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=94c6cf0868fa5cb930a5e2d71baf0dbf",{maxZoom:18}),Wind=L.tileLayer("https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid=94c6cf0868fa5cb930a5e2d71baf0dbf",{maxZoom:18}),Pressure=L.tileLayer("https://tile.openweathermap.org/map/pressure_new/{z}/{x}/{y}.png?appid=94c6cf0868fa5cb930a5e2d71baf0dbf",{maxZoom:18}),Clouds=L.tileLayer("https://tile.openweathermap.org/map/clouds_new/{z}/{x}/{y}.png?appid=94c6cf0868fa5cb930a5e2d71baf0dbf",{maxZoom:18});Temp.addTo(map);var overlays={"Température":Temp,"Précipitations":Precipitation,Nuages:Clouds,"Pression de l'air":Pressure,"Vitesse du vent":Wind};L.control.layers(overlays,null,{collapsed:!1}).addTo(map);var greenIcon=new L.Icon({iconUrl:"images/marker-icon-2x-green.png",shadowUrl:"images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});if("undefined"!=typeof favs){var i=0;$.each(favs,function(e,a){$.get("ajax.php",{lat:a.lat,lng:a.lon},function(e,o){var n=JSON.parse(e);window["fav"+i]=L.marker([a.lat,a.lon],{icon:greenIcon}).addTo(map),window["fav"+i].bindPopup(n.meteo),window["fav"+i].on("click",function(){$("#city").val(n.city)})}),i++})}map.on("click",function(e){var a=e.latlng.lat,o=e.latlng.lng;a&&o&&$.get("ajax.php",{lat:a,lng:o},function(e,n){var t=JSON.parse(e);marker?(marker.setLatLng([a,o]),"Ville introuvable"==t.meteo?marker.setPopupContent(t.meteo):marker.setPopupContent(t.meteo+" <input height='22' width='12' type='image' id='add-fav' src='images/marker-icon-2x-green.png' alt='marker add'/>"),marker.openPopup(),map.panTo([marker.getLatLng().lat,marker.getLatLng().lng]),"undefined"!=typeof id?$("#add-fav").on("click",function(){$.get("ajax.php",{latitude:marker.getLatLng().lat,longitude:marker.getLatLng().lng,id:id},function(e,a){marker.setPopupContent(t.meteo);var o=JSON.parse(e);window["fav"+i]=L.marker([o.newLat,o.newLon],{icon:greenIcon}).addTo(map),window["fav"+i].bindPopup(t.meteo),window["fav"+i].on("click",function(){$("#city").val(t.city)}),i++})}):$("#add-fav").on("click",function(){window.location.href="connexion.html"}),$("#city").val(t.city)):(marker=L.marker([a,o]),"Ville introuvable"==t.meteo?marker.bindPopup(t.meteo):marker.bindPopup(t.meteo+" <input height='22' width='12' type='image' id='add-fav' src='images/marker-icon-2x-green.png' alt='marker add'/>"),marker.addTo(map),marker.openPopup(),map.panTo([marker.getLatLng().lat,marker.getLatLng().lng]),"undefined"!=typeof id?$("#add-fav").on("click",function(){$.get("ajax.php",{latitude:marker.getLatLng().lat,longitude:marker.getLatLng().lng,id:id},function(e,a){marker.setPopupContent(t.meteo);var o=JSON.parse(e);window["fav"+i]=L.marker([o.newLat,o.newLon],{icon:greenIcon}).addTo(map),window["fav"+i].bindPopup(t.meteo),window["fav"+i].on("click",function(){$("#city").val(t.city)}),i++})}):$("#add-fav").on("click",function(){window.location.href="connexion.html"}),$("#city").val(t.city))})}),$("#city").on("keydown paste focus mousedown",function(e){9!=e.keyCode&&e.preventDefault()});const legend=L.control.Legend({position:"bottomleft",collapsed:!1,symbolWidth:24,opacity:.8,column:1,legends:[{label:"Votre marqueur",type:"image",url:"images/marker-icon-2x-blue.png"},{label:"Villes favorites",type:"image",url:"images/marker-icon-2x-green.png"}]}).addTo(map);